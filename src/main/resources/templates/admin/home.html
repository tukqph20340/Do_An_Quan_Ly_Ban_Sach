<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>

    <!-- Basic Page Needs
    ================================================== -->
    <title>Admin Page</title>
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1, maximum-scale=1">

    <!-- CSS
    ================================================== -->
    <link rel="stylesheet" href="/listeo/css/style.css">
    <link rel="stylesheet" href="/listeo/css/main-color.css" id="colors">
    <link rel="icon" href="/img/logo-3.png">
</head>

<body>

<!-- Wrapper -->
<div id="wrapper">

    <!-- Header Container
================================================== -->
    <header id="header-container" class="fixed fullwidth dashboard">

        <!-- Header -->
        <div id="header" class="not-sticky">
            <div class="container">

                <!-- Left Side Content -->
                <div class="left-side">

                    <!-- Logo -->
                    <div id="logo">
                        <a href="index.html"><img src="images/logo.png" alt=""></a>
                        <a href="index.html" class="dashboard-logo"><img
                                src="images/logo2.png" alt=""></a>
                    </div>

                    <!-- Mobile Navigation -->
                    <div class="mmenu-trigger">
                        <button class="hamburger hamburger--collapse" type="button">
								<span class="hamburger-box"> <span
                                        class="hamburger-inner"></span>
								</span>
                        </button>
                    </div>
                    <div class="clearfix"></div>
                    <!-- Main Navigation / End -->

                </div>
                <!-- Left Side Content / End -->

                <!-- Right Side Content / End -->
                <div class="right-side">
                    <!-- Header Widget -->
                    <div class="header-widget">

                        <!-- User Menu -->
                        <div class="user-menu">
                            <div class="user-name">
                                Tài Khoản
                            </div>
                            <ul>
                                <li><a href="/dashboard-myprofile"><i
                                        class="sl sl-icon-settings"></i> Đổi Mật Khẩu</a></li>
                            </ul>
                        </div>

                        <a th:href="@{/add-san-pham}"
                           class="button border with-icon">Thêm Sản Phẩm<i
                        ></i></a>
                    </div>
                    <!-- Header Widget / End -->
                </div>
                <!-- Right Side Content / End -->
            </div>
        </div>
        <!-- Header / End -->

    </header>
    <div class="clearfix"></div>
    <!-- Header Container / End -->


    <!-- Dashboard -->
    <div id="dashboard">

        <!-- Navigation
================================================== -->

        <!-- Responsive Navigation Trigger -->
        <a href="#" class="dashboard-responsive-nav-trigger"><i
                class="fa fa-reorder"></i> Dashboard Navigation</a>

        <div class="dashboard-nav">
            <div class="dashboard-nav-inner">
                <ul data-submenu-title="Trang Chủ">
                    <li class="active"><a href="/home-admin"><i
                            class="sl sl-icon-settings"></i> Trang Chủ</a></li>
                    <li><a href="#"><i
                            class="sl sl-icon-wallet"></i> Thông Kê</a>
                        <ul id="sub">

                            <li><a href="/thong-ke-admin-san-pham">Thông Kê Loại Sản Phẩm</a></li>
                            <li><a href="/thong-ke-admin-don-hang">Thông Kê Đơn Hàng</a></li>
                            <li><a href="/thong-ke-admin-doanh-thu">Thông Kê Doanh Thu</a></li>

                        </ul>
                    </li>
                    <li><a href="#"><i
                            class="fa fa-calendar-check-o"></i> Quản Lý Giao Dịch</a>
                        <ul id="sub">

                            <li><a href="/dashboard-orders1">Chờ Xác Nhận</a></li>
                            <li><a href="/dashboard-orders2">Chờ lấy hàng</a></li>
                            <li><a href="/dashboard-orders3">Đã Lấy Hàng</a></li>
                            <li><a href="/dashboard-orders4">Đang Giao</a></li>
                            <li><a href="/dashboard-orders6">Đơn Đã Giao Thành Công</a></li>
                            <li><a href="/dashboard-orders7">Hủy</a></li>
                            <li><a href="/dashboard-orders8">Đổi Trả</a></li>
                            <li><a href="/dashboard-orders9">Thất Bại</a></li>
                        </ul>

                    </li>
                    <ul data-submenu-title="Sản Phẩm">
                        <li><a href="#"> <i
                                class="sl sl-icon-layers"></i>Quản Lý Sản Phẩm</a>
                            <ul id="sub">

                                <li><a href="/san-pham-admin">Sản Phẩm</a></li>

                                <li><a href="/tac-gia-admin">Tác Giả</a></li>

                                <li><a href="/nha-san-xuat-admin">Nhà Xuất Bản</a></li>

                                <li><a href="/bia-admin">Bìa Sách</a></li>

                                <li><a href="/the-loai-admin">Thể Loại Sách</a></li>

                                <li><a href="/khuyen-mai/admin">Khuyến mãi</a></li>
                            </ul>
                        </li>
                    </ul>
                    <ul data-submenu-title="Người Dùng">
                        <li><a href="/nguoi-dung-admin"><i
                                class="sl sl-icon-user"></i>Quản Lý Tài Khoản</a></li>
                        <li><a href="/dang-xuat"><i
                                class="sl sl-icon-power"></i> Đăng Xuất</a></li>
                    </ul>
                    <ul data-submenu-title="Home">
                        <li><a href="/home"><i class="im im-icon-Home"></i>
                            Trang Chủ</a></li>
                    </ul>
                </ul>
            </div>
        </div>
        <!-- Navigation / End -->


        <!-- Content
================================================== -->
        <div class="dashboard-content">
            <!-- Titlebar -->
            <div id="titlebar">
                <div class="row">
                    <!--                    <div class="col-md-12">-->
                    <!--                        <h2 th:text="${session.admin.user_Name + '!'}"></h2>-->
                    <!--                        &lt;!&ndash; Breadcrumbs &ndash;&gt;-->
                    <!--                        <nav id="breadcrumbs">-->
                    <!--                            <ul>-->
                    <!--                                <li><a href="#">Home</a></li>-->
                    <!--                                <li>Dashboard</li>-->
                    <!--                            </ul>-->
                    <!--                        </nav>-->
                    <!--                    </div>-->
                </div>
            </div>

            <!-- Content -->
            <div class="row" style="justify-content: center; display: flex;">

                <!-- Item -->
                <div class="col-lg-3 col-md-6">
                    <div class="dashboard-stat color-1">
                        <div class="dashboard-stat-content">
                            <h4 th:text="${Total_Order}"></h4>
                            <span>Tổng số đơn đặt hàng</span>
                        </div>
                        <div class="dashboard-stat-icon">
                            <i class="im im-icon-Add-Bag"></i>
                        </div>
                    </div>
                </div>

                <!-- Item -->
                <div class="col-lg-3 col-md-6">
                    <div class="dashboard-stat color-2">
                        <div class="dashboard-stat-content">
                            <h4 th:text="${Total_Product}"></h4>
                            <span>Tổng số sản phẩm</span>
                        </div>
                        <div class="dashboard-stat-icon">
                            <i class="im im-icon-Polo-Shirt"></i>
                        </div>
                    </div>
                </div>


                <!-- Item -->
                <div class="col-lg-3 col-md-6">
                    <div class="dashboard-stat color-3">
                        <div class="dashboard-stat-content">
                            <h4 th:text="${Total_User}"></h4>
                            <span>Số người dùng trang web</span>
                        </div>
                        <div class="dashboard-stat-icon">
                            <i class="im im-icon-Add-UserStar"></i>
                        </div>
                    </div>
                </div>

                <!-- Item -->
                <div class="col-lg-3 col-md-6">
                    <div class="dashboard-stat color-4">
                        <div class="dashboard-stat-content">
                            <h4 th:text="${Total_Category}"></h4>
                            <span>Tổng số danh mục</span>
                        </div>
                        <div class="dashboard-stat-icon">
                            <i class="im im-icon-Box-withFolders"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row" style="margin-bottom: 70px;">
                <div class="col-lg-12 col-md-12">
                    <button style="margin-left: 477px" onclick="toggleMode()">Ngày - Tháng - Năm</button>
                    <div class="dashboard-list-box with-icons margin-top-20">
                        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
                        <div>
                            <canvas id="myChart"></canvas>
                        </div>
                        <script th:inline="javascript">
                            /*<![CDATA[*/
                            const ctx = document.getElementById('myChart');
                            const daysToShow = 14;
                            const monthsToShow = 12;
                            const yearsToShow = 7;
                            let startIndex = 0;
                            let currentMode = 'ngay';

                            function generateRecentDates(numDays) {
                                const today = new Date();
                                const labels = [];

                                for (let i = numDays - 1; i >= 0; i--) {
                                    const date = new Date(today);
                                    date.setDate(today.getDate() - i);
                                    const dateString = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}`;
                                    labels.push(dateString);
                                }

                                return labels;
                            }

                            function generateRecentMonths(numMonths) {
                                const today = new Date();
                                const labels = [];

                                for (let i = numMonths - 1; i >= 0; i--) {
                                    const date = new Date(today);
                                    date.setMonth(today.getMonth() - i);
                                    const dateString = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}`;
                                    labels.push(dateString);
                                }

                                return labels;
                            }

                            function generateRecentYears(numYears) {
                                const today = new Date();
                                const labels = [];

                                for (let i = numYears - 1; i >= 0; i--) {
                                    const date = new Date(today);
                                    date.setFullYear(today.getFullYear() - i);
                                    const dateString = `${date.getFullYear()}`;
                                    labels.push(dateString);
                                }

                                return labels;
                            }

                            function showChart(data, mode) {
                                const labels = (mode === 'ngay') ? generateRecentDates(daysToShow) : (mode === 'thangNam') ? generateRecentMonths(monthsToShow) : generateRecentYears(yearsToShow);
                                const totalValues = labels.map(label => {
                                    const foundItem = data.find(item => item[mode] === label);
                                    return foundItem ? foundItem.tongTien : 0;
                                });

                                const totalVi = labels.map(label => {
                                    const foundItem = data.find(item => item[mode] === label);
                                    return foundItem ? foundItem.totalVi : 0;
                                });

                                const momoValues = labels.map(label => {
                                    const foundItem = data.find(item => item[mode] === label);
                                    return foundItem ? foundItem.totalMomo : 0;
                                });

                                const deliveryValues = labels.map(label => {
                                    const foundItem = data.find(item => item[mode] === label);
                                    return foundItem ? foundItem.totalDelivery : 0;
                                });

                                // Huỷ bỏ biểu đồ hiện tại nếu đã tồn tại
                                if (ctx.chart) {
                                    ctx.chart.destroy();
                                }

                                // Tạo biểu đồ mới
                                ctx.chart = new Chart(ctx, {
                                    type: 'bar',
                                    data: {
                                        labels: labels,
                                        datasets: [{
                                            label: 'Tổng Giá',
                                            data: totalValues,
                                            borderWidth: 1
                                        }, {
                                            label: 'Momo',
                                            data: momoValues,
                                            borderWidth: 1
                                        }, {
                                                label: 'Ví',
                                                data: totalVi,
                                                borderWidth: 1
                                            }, {
                                                label: 'Trực Tiếp',
                                                data: deliveryValues,
                                                borderWidth: 1
                                            }]
                                    },
                                    options: {
                                        scales: {
                                            x: {
                                                title: {
                                                    display: true,
                                                    text: (mode === 'ngay') ? 'Ngày' : (mode === 'thangNam') ? 'Tháng' : 'Năm',
                                                }
                                            },
                                            y: {
                                                beginAtZero: true,
                                                title: {
                                                    display: true,
                                                    text: 'Tổng Tiền'
                                                }
                                            }
                                        }
                                    }
                                });
                            }

                            function fetchDataAndShowChart(mode) {
                                const apiUrl = (mode === 'ngay') ? `/api/revenue-by-payment?startIndex=${startIndex}` :
                                    (mode === 'thangNam') ? '/api/revenue-by-payment-thang' : (mode === 'nam') ?
                                        '/api/revenue-by-payment-nam' : '404';

                                fetch(apiUrl)
                                    .then(response => response.json())
                                    .then(data => {
                                        showChart(data, mode);
                                    })
                                    .catch(error => {
                                        console.error("Error: " + error);
                                    });
                            }

                            function showPrevious() {
                                if (startIndex > 0) {
                                    startIndex--;
                                    fetchDataAndShowChart(currentMode);
                                }
                            }

                            function showNext() {
                                fetchDataAndShowChart(startIndex + 1);
                            }

                            function toggleMode() {
                                switch (currentMode) {
                                    case 'ngay':
                                        currentMode = 'thangNam';
                                        break;
                                    case 'thangNam':
                                        currentMode = 'nam';
                                        break;
                                    case 'nam':
                                        currentMode = 'ngay';
                                        break;
                                    default:
                                        break;
                                }
                                fetchDataAndShowChart(currentMode);
                            }

                            // Khi gọi fetchDataAndShowChart, truyền startIndex vào
                            fetchDataAndShowChart(currentMode);
                            /*]]>*/
                        </script>

                    </div>
                </div>

                <!-- Recent Activity -->
                <!--                <div class="col-lg-6 col-md-12">-->
                <!--                    <div class="dashboard-list-box with-icons margin-top-20">-->
                <!--                        <h4>Recent Customers</h4>-->
                <!--                        <ul>-->
                <!--                            <th:block th:each="y : ${recentCustomer}">-->
                <!--                                <li style="padding-left: 30px;"><img-->
                <!--                                        style="width: 45px; border-radius: 50%"-->
                <!--                                        th:src="${y.avatar}"-->
                <!--                                        alt=""><strong th:text="${y.user_Name}"></strong> <a-->
                <!--                                        th:text="'Email: ' + ${y.email}"></a></li>-->
                <!--                            </th:block>-->
                <!--                        </ul>-->
                <!--                    </div>-->
                <!--                </div>-->

                <!--                &lt;!&ndash; Invoices &ndash;&gt;-->
                <!--                <div class="col-lg-6 col-md-12">-->
                <!--                    <div class="dashboard-list-box invoices with-icons margin-top-20">-->
                <!--                        <h4>Recent Orders</h4>-->
                <!--                        <ul>-->
                <!--                            <th:block th:each="y : ${recentOrders}">-->
                <!--                                <li><i class="list-box-icon sl sl-icon-doc"></i> <strong-->
                <!--                                        th:text="${y.user.user_Name}"></strong>-->
                <!--                                    <ul>-->
                <!--                                        <li th:if="${y.payment_Method == 'Payment on delivery'}" class="unpaid">Payment-->
                <!--                                            on delivery-->
                <!--                                        </li>-->
                <!--                                        <li th:if="${y.payment_Method == 'Payment with momo'}" class="paid">Payment with-->
                <!--                                            momo-->
                <!--                                        </li>-->
                <!--                                        <li th:text="'Order: #' + ${y.id}">Order:</li>-->
                <!--                                        <li th:text="'Date: ' + ${#dates.format(y.booking_Date, 'dd/MM/yyyy')}"></li>-->
                <!--                                        <li th:text="'Price: ' + ${#numbers.formatDecimal(y.total, 0, 'COMMA', 0, 'POINT')} + ' VNĐ'"></li>-->
                <!--                                    </ul>-->
                <!--                                    <div class="buttons-to-right">-->
                <!--                                        <a th:href="@{/dashboard-invoice/{id}(id=${y.id})}" class="button gray">View-->
                <!--                                            Invoice</a>-->
                <!--                                    </div>-->
                <!--                                </li>-->
                <!--                            </th:block>-->

                <!--                        </ul>-->
                <!--                    </div>-->
                <!--                </div>-->
                <!--            </div>-->

            </div>
            <!-- Content / End -->


        </div>
        <!-- Dashboard / End -->


    </div>
    <!-- Wrapper / End -->


    <!-- Scripts
    ================================================== -->
    <script type="text/javascript" src="scripts/jquery-3.6.0.min.js"></script>
    <script type="text/javascript"
            src="scripts/jquery-migrate-3.3.2.min.js"></script>
    <script type="text/javascript" src="scripts/mmenu.min.js"></script>
    <script type="text/javascript" src="scripts/chosen.min.js"></script>
    <script type="text/javascript" src="scripts/slick.min.js"></script>
    <script type="text/javascript" src="scripts/rangeslider.min.js"></script>
    <script type="text/javascript" src="scripts/magnific-popup.min.js"></script>
    <script type="text/javascript" src="scripts/waypoints.min.js"></script>
    <script type="text/javascript" src="scripts/counterup.min.js"></script>
    <script type="text/javascript" src="scripts/jquery-ui.min.js"></script>
    <script type="text/javascript" src="scripts/tooltips.min.js"></script>
    <script type="text/javascript" src="scripts/custom.js"></script>


</body>
</html>
